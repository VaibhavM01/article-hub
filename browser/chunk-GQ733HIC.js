import{c as te,e as ne,i as ie,n as oe,p as T,q as D,r as me}from"./chunk-PFKHLFJJ.js";import{a as ce}from"./chunk-DO2GBO5P.js";import{A as g,B as _,Ba as M,Da as w,H as B,J as f,K as z,Ka as J,L as U,La as K,N as r,P as v,Pa as y,Q as O,Qa as P,Ua as k,V as C,Xa as A,_ as l,_a as Q,a as F,aa as $,ab as X,b as N,bb as Y,c as R,ca as m,da as o,db as Z,ea as S,f as V,hb as ee,ia as h,j as L,ja as u,ka as a,s as j,sa as c,ta as d,ua as I,ub as re,va as H,w as b,wa as W,xa as q,za as G}from"./chunk-NTXCGKWX.js";var x=class i{firestoreService=b(re);getCommentsForArticle(t,e="newest"){return L(()=>this.firestoreService.getCommentsForArticle(t,e))}addComment(t){return V(this.firestoreService.postComment({commentId:t.commentId,articleId:t.articleId,text:t.content,userId:t.userId,userName:t.userName,parentId:t.parentId??null,likes:t.likes??0,timestamp:t.timestamp??new Date().toISOString()}))}static \u0275fac=function(e){return new(e||i)};static \u0275prov=j({token:i,factory:i.\u0275fac,providedIn:"root"})};function ge(i,t){if(i&1&&(m(0,"div",11)(1,"div",12)(2,"strong"),c(3),o(),m(4,"p"),c(5),o(),m(6,"small"),c(7),M(8,"date"),o()()()),i&2){let e=t.$implicit;r(3),d(e.userName),r(2),d(e.text),r(2),d(w(8,3,e.createdAt==null?null:e.createdAt.toDate(),"short"))}}function _e(i,t){if(i&1){let e=h();m(0,"div")(1,"textarea",13),u("ngModelChange",function(s){g(e);let p=a().$implicit,le=a();return _(le.setReplyInput(p.id,s))}),o(),m(2,"button",2),u("click",function(){g(e);let s=a().$implicit,p=a();return _(p.postComment(s.id))}),c(3,"Post Reply"),o()()}if(i&2){let e=a().$implicit,n=a();r(),l("ngModel",n.replyInputs()[e.id]||"")}}function Ce(i,t){if(i&1){let e=h();m(0,"div")(1,"div",8)(2,"strong"),c(3),o(),m(4,"p"),c(5),o(),m(6,"small"),c(7),M(8,"date"),o(),m(9,"button",2),u("click",function(){let s=g(e).$implicit,p=a();return _(p.replyTo.set(s.id))}),c(10,"Reply"),o()(),C(11,ge,9,6,"div",9)(12,_e,4,1,"div",10),o()}if(i&2){let e=t.$implicit,n=a();r(3),d(e.userName),r(2),d(e.text),r(2),d(w(8,5,e.createdAt==null?null:e.createdAt.toDate(),"short")),r(4),l("ngForOf",n.repliesFor(e.id)),r(),l("ngIf",n.replyTo()===e.id)}}function fe(i,t){if(i&1&&(m(0,"div",14),c(1),o()),i&2){let e=a();r(),d(e.errorMessage())}}var E=class i{articleId=B("");commentService=b(x);auth=b(ee);errorMessage=f("");comments=f([]);sortBy=f("newest");commentInput=f("");replyInputs=f({});replyTo=f(null);constructor(){K(()=>{this.articleId()&&this.loadComments()})}ngOnInit(){}loadComments(){return R(this,null,function*(){this.commentService.getCommentsForArticle(this.articleId(),this.sortBy()).subscribe(t=>{this.comments.set(t)})})}postComment(t=null){return R(this,null,function*(){let e=yield this.auth.currentUser,n=t?this.replyInputs()[t]:this.commentInput();if(!e||!n?.trim()){this.errorMessage.set("Please log in to post a comment.");return}yield this.commentService.addComment({commentId:"",articleId:this.articleId(),content:n.trim(),userId:e.uid,userName:e.displayName||"Anonymous",parentId:t??null,likes:0,timestamp:new Date().toISOString()}).toPromise(),t?(this.replyInputs.update(s=>N(F({},s),{[t]:""})),this.replyTo.set(null)):this.commentInput.set(""),this.loadComments()})}topLevelComments=J(()=>this.comments().filter(t=>!t.parentId));repliesFor=t=>this.comments().filter(e=>e.parentId===t);setReplyInput(t,e){this.replyInputs.update(n=>N(F({},n),{[t]:e}))}setSort(t){this.sortBy.set(t),this.loadComments()}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=O({type:i,selectors:[["app-comments"]],inputs:{articleId:[1,"articleId"]},decls:20,vars:4,consts:[[1,"comment-section"],[1,"sort-buttons"],[3,"click"],[4,"ngFor","ngForOf"],[1,"new-comment"],["maxlength","250",3,"ngModelChange","ngModel"],[1,"comment-char-count"],["class","error-message",4,"ngIf"],[1,"comment"],["class","replies",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"replies"],[1,"comment","reply"],[3,"ngModelChange","ngModel"],[1,"error-message"]],template:function(e,n){e&1&&(m(0,"div",0)(1,"h3"),c(2,"Comments"),o(),m(3,"div",1)(4,"button",2),u("click",function(){return n.setSort("newest")}),c(5,"Newest"),o(),m(6,"button",2),u("click",function(){return n.setSort("oldest")}),c(7,"Oldest"),o(),m(8,"button",2),u("click",function(){return n.setSort("mostLiked")}),c(9,"Most Liked"),o()(),C(10,Ce,13,8,"div",3),m(11,"div",4)(12,"h4"),c(13,"Leave a Comment"),o(),m(14,"textarea",5),q("ngModelChange",function(p){return W(n.commentInput,p)||(n.commentInput=p),p}),o(),m(15,"div",6),c(16),o(),C(17,fe,2,1,"div",7),m(18,"button",2),u("click",function(){return n.postComment()}),c(19,"Post"),o()()()),e&2&&(r(10),l("ngForOf",n.topLevelComments()),r(4),H("ngModel",n.commentInput),r(2),I("",n.commentInput().length,"/250"),r(),l("ngIf",n.errorMessage()))},dependencies:[A,y,P,k,D,te,ne,oe,T,ie],styles:[".comment-section[_ngcontent-%COMP%]{padding:1rem;background:#f9f9f9;border-radius:8px}.comment-section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%], .comment-section[_ngcontent-%COMP%]   .sort-buttons[_ngcontent-%COMP%]{margin-bottom:1rem}.comment-section[_ngcontent-%COMP%]   .sort-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-right:.5rem;padding:.3rem .7rem;background:#e0e0e0;border:none;border-radius:4px;cursor:pointer}.comment-section[_ngcontent-%COMP%]   .sort-buttons[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background:#ccc}.comment-section[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]{background:#acb6cb;padding:.8rem;margin-bottom:.5rem;border-radius:6px}.comment-section[_ngcontent-%COMP%]   .comment.reply[_ngcontent-%COMP%]{margin-left:1rem;background:#c1cbdf}.comment-section[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0}.comment-section[_ngcontent-%COMP%]   .comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:.3rem;font-size:.8rem;background:transparent;border:none;color:#007bff;cursor:pointer}.comment-section[_ngcontent-%COMP%]   .new-comment[_ngcontent-%COMP%]{margin-top:1.5rem}.comment-section[_ngcontent-%COMP%]   .new-comment[_ngcontent-%COMP%]   textarea[_ngcontent-%COMP%]{width:100%;min-height:80px;margin-bottom:.5rem}.comment-section[_ngcontent-%COMP%]   .new-comment[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem}.error-message[_ngcontent-%COMP%]{color:red;margin-top:1rem;display:block;text-align:center;font-weight:500;font-size:.95rem}.comment-char-count[_ngcontent-%COMP%]{font-size:.8rem;color:#666;margin-top:.5rem}"]})};var he=i=>["/author",i];function ve(i,t){if(i&1){let e=h();m(0,"li",13)(1,"h4",14)(2,"a",9),u("click",function(){let s=g(e).$implicit,p=a(3);return _(p.navigateToArticle(s.id))}),c(3),o()(),m(4,"p",15),c(5),o()()}if(i&2){let e=t.$implicit;r(3),d(e.title),r(2),d(e.description)}}function xe(i,t){if(i&1&&(m(0,"section",10)(1,"h3"),c(2,"Related Articles"),o(),m(3,"ul",11),C(4,ve,6,2,"li",12),o()()),i&2){let e=a(2);r(4),l("ngForOf",e.related)}}function be(i,t){if(i&1){let e=h();m(0,"section",2)(1,"h1"),c(2),o(),m(3,"p",3),c(4," By "),m(5,"a",4),c(6),o(),c(7),M(8,"date"),o(),S(9,"img",5)(10,"article",6)(11,"hr"),C(12,xe,5,1,"section",7),S(13,"hr"),m(14,"div",8)(15,"button",9),u("click",function(){g(e);let s=a();return _(s.showComments=!0)}),c(16),o()()()}if(i&2){let e=a();$("blurred",e.showComments),r(2),d(e.article.title),r(3),l("routerLink",G(13,he,e.article.authorId)),r(),d(e.article.authorName),r(),I(" | ",w(8,10,e.article.publishDate,"longDate")," "),r(2),l("src",e.article.thumbnailUrl,U),r(),l("innerHTML",e.article.content,z),r(2),l("ngIf",e.related.length),r(4),I("View Comments (",e.commentCount||0,")")}}function Ie(i,t){if(i&1){let e=h();m(0,"div",16)(1,"div",17)(2,"button",18),u("click",function(){g(e);let s=a();return _(s.showComments=!1)}),c(3,"\xD7"),o(),S(4,"app-comments",19),o()()}if(i&2){let e=a();r(4),l("articleId",e.article==null?null:e.article.id)}}var ae=class i{constructor(t,e,n,s,p){this.router=t;this.route=e;this.articleService=n;this.commentService=s;this.authservice=p}article;related=[];comments=[];newComment="";selectedSort="newest";currentUser;showComments=!1;commentCount=0;ngOnInit(){let t=this.route.snapshot.paramMap.get("id");t&&this.articleService.getArticleById(t).then(e=>{e?(this.article=e,this.article.id=t,this.loadRelatedArticles(t),this.loadComments(t)):console.error("ArticleDetailComponent: Article not found")})}loadRelatedArticles(t){this.articleService.getRelatedArticles(t).subscribe(e=>{this.related=e})}loadComments(t){this.commentService.getCommentsForArticle(t).subscribe(e=>{this.comments=this.sortComments(e,this.selectedSort)})}sortComments(t,e){switch(e){case"oldest":return t.sort((n,s)=>new Date(n.timestamp).getTime()-new Date(s.timestamp).getTime());case"mostLiked":return t.sort((n,s)=>s.likes-n.likes);case"newest":default:return t.sort((n,s)=>new Date(s.timestamp).getTime()-new Date(n.timestamp).getTime())}}submitComment(t){if(!this.article||!this.newComment.trim())return;this.currentUser=this.authservice.getCurrentUser();let e={commentId:Math.random().toString(36).substring(2,11),articleId:this.route.snapshot.paramMap.get("id"),userId:this.currentUser?.uid,userName:this.currentUser.displayName,content:this.newComment,timestamp:new Date().toISOString(),likes:0,parentId:t||null};this.commentService.addComment(e).subscribe(()=>{this.newComment="",this.loadComments(this.article.id)})}changeSort(t){this.selectedSort=t,this.article&&this.loadComments(this.article.id)}getReplies(t){return this.comments.filter(e=>e.parentId===t)}get topLevelComments(){return this.comments.filter(t=>!t.parentId)}navigateToArticle(t){this.router.navigate(["/article",t]),this.articleService.getArticleById(t).then(e=>{e&&(this.article=e,this.loadRelatedArticles(t),this.loadComments(t))})}static \u0275fac=function(e){return new(e||i)(v(X),v(Q),v(ce),v(x),v(me))};static \u0275cmp=O({type:i,selectors:[["app-article-detail"]],decls:2,vars:2,consts:[["class","article-detail-container",3,"blurred",4,"ngIf"],["class","comment-overlay",4,"ngIf"],[1,"article-detail-container"],[1,"meta"],[3,"routerLink"],["id","artile-thumbnail","alt","Article Thumbnail",1,"thumbnail",3,"src"],[1,"content",3,"innerHTML"],["class","related-section",4,"ngIf"],[1,"view-comments"],[3,"click"],[1,"related-section"],[1,"related-list"],["class","related-article",4,"ngFor","ngForOf"],[1,"related-article"],[1,"related-title"],[1,"article-detail-content-container"],[1,"comment-overlay"],[1,"comment-drawer"],[1,"close-btn",3,"click"],[3,"articleId"]],template:function(e,n){e&1&&C(0,be,17,15,"section",0)(1,Ie,5,1,"div",1),e&2&&(l("ngIf",n.article),r(),l("ngIf",n.showComments))},dependencies:[A,y,P,k,T,D,Z,Y,E],styles:[".article-detail-container[_ngcontent-%COMP%]{padding:1rem;transition:filter .3s ease}.article-detail-container.blurred[_ngcontent-%COMP%]{filter:blur(5px);pointer-events:none;-webkit-user-select:none;user-select:none}.article-detail-container[_ngcontent-%COMP%]{max-width:800px;margin:0 auto;padding:2rem;display:flex;flex-direction:column;gap:1.5rem;background-color:#fff;border-radius:12px;box-shadow:0 0 12px #0000001a}.article-detail-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:auto;max-height:400px;border-radius:8px;object-fit:cover;box-shadow:0 2px 8px #0000000d}#artile-thumbnail[_ngcontent-%COMP%]{width:100%;height:auto;max-height:400px;border-radius:12px;box-shadow:0 2px 8px #0000001a}.related-title[_ngcontent-%COMP%]{color:#007bff;cursor:pointer}.view-comments[_ngcontent-%COMP%]{text-align:center;margin-top:2rem}.view-comments[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{padding:.5rem 1rem;background-color:#007bff;color:#fff;border:none;border-radius:6px;font-size:1rem;cursor:pointer}.view-comments[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#0056b3}.comment-overlay[_ngcontent-%COMP%]{position:fixed;top:0;right:0;width:40%;height:100vh;background:#fff;z-index:1000;box-shadow:-2px 0 10px #0003;overflow-y:auto;transition:all .3s ease-in-out}.comment-drawer[_ngcontent-%COMP%]{padding:1rem;position:relative}.close-btn[_ngcontent-%COMP%]{position:absolute;top:1rem;right:1rem;font-size:1.5rem;background:transparent;border:none;cursor:pointer}.article-detail-content-container[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{margin-top:1.4rem;width:350px;max-width:350px;max-height:350px}"]})};export{ae as ArticleDetailComponent};
